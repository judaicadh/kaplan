---
import "../styles/global.css";
import Nav from '../components/Layout/Nav.astro';
import Footer from '../components/Layout/Footer.astro';
import { SEO } from "astro-seo";
import { GoogleTagmanagerPartytown, SiteVerification } from "@digi4care/astro-google-tagmanager";
import HeadMeta from "../components/Layout/HeadMeta.astro";

// Single source of truth for site constants
const SITE = {
	baseUrl: "https://www.kaplancollection.org",
	sectionBase: "/",
	name: "Arnold & Deanne Kaplan Collection of Early American Judaica",
	org: "Judaica Digital Humanities at the University of Pennsylvania Libraries",
	defaultDescription:
		"Discover prints, manuscripts, ephemera, newspapers, and artifacts documenting early American and Atlantic Jewish life.",
	defaultOgImage: "/images/kaplan_logo.png",
	twitterCreator: "@upennlib",
};

// Props + computed URLs (for <SEO />)
const {
	title = SITE.name,
	description = SITE.defaultDescription,
	ogImage = SITE.defaultOgImage,
	ogType = "website",
	noindex = false,
	// NEW: allow pages to pass additional JSON-LD nodes
	headGraph = []   // <- pages provide an array of nodes, not a whole object
} = Astro.props;

const baseUrl = Astro.site?.href ?? SITE.baseUrl;
const pathname = Astro.url.pathname;
const url = new URL(pathname, baseUrl).toString();
const absoluteOg = ogImage.startsWith("http") ? ogImage : new URL(ogImage, baseUrl).toString();
---

<html lang="en">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<link rel="sitemap" href="/sitemap-index.xml" />

	<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orestbida/cookieconsent@3.1.0/dist/cookieconsent.css">

	<SiteVerification id="EtZcuOhLAz4SNqrZtPY9nRSHvzTE_xXlc45DQDYP8QQ" />
	<GoogleTagmanagerPartytown id="GTM-PQRJQQNM" />

	<!-- ONE place where JSON-LD is rendered -->
	<HeadMeta
		baseUrl={SITE.baseUrl}
		sectionBase={SITE.sectionBase}
		siteName={SITE.name}
		orgName={SITE.org}
		siteDescription={SITE.defaultDescription}
		graph={headGraph}
	/>

	<SEO
		title={title}
		description={description}
		noindex={noindex}
		openGraph={{ basic: { title, type: ogType, image: absoluteOg, url }, optional: { siteName: SITE.name } }}
		twitter={{ creator: SITE.twitterCreator, card: "summary_large_image", title, description, image: absoluteOg, imageAlt: "Kaplan Collection preview image" }}
		extend={{ link: [{ rel: "canonical", href: url }, { rel: "icon", href: "/favicon.ico" }], meta: [{ name: "theme-color", content: "#ffffff" }] }}
	/>

	<!-- still allow pages to add extra <head> tags if needed -->
	<slot name="headContent" />
</head>
<body class="bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100 font-merriweather">
<a href="#main" class="sr-only focus:not-sr-only focus:absolute focus:top-2 focus:left-2 focus:rounded focus:bg-white focus:px-3 focus:py-2 focus:ring">
	Skip to content
</a>

<div class="flex flex-col min-h-screen">
	<Nav />
	<main id="main" class="flex-grow">
		<slot />
	</main>
	<Footer />
</div>

<script type="module" src="/scripts/cookieconsent-config.js"></script>
</body>
</html>