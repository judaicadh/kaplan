---
import BaseLayout from '../../layouts/BaseLayout.astro'
import items from '../../data/items.json' // Import your items data
import { slugify } from '../../utils/slugify.js'

// Generate dynamic paths using slugs
export async function getStaticPaths() {
	const subjectUris = items.flatMap((item) =>
		item.subjectAI.map((subject) => slugify(subject.name))
	)

	const uniqueSlugs = Array.from(new Set(subjectUris))

	return uniqueSlugs.map((slug) => ({ params: { slug } }))
}

// Get the dynamic slug from the URL
const { slug } = Astro.params

// Find all items with the matching subject
const subjectItems = items.filter((item) =>
	item.subjectAI.some((subject) => slugify(subject.name) === slug)
)

if (!subjectItems.length) {
	throw new Error(`No items found for subject ${slug}`)
}

// Get the subject name from the first matching item
const subjectName = subjectItems[0].subjectAI.find(
	(subject) => slugify(subject.name) === slug
)?.name || 'Unknown Subject'
---

<BaseLayout title={`Subject: ${subjectName}`}>
	<section class="py-8 bg-white md:py-16 dark:bg-gray-900 antialiased">
		<div class="max-w-screen-xl px-4 mx-auto 2xl:px-0">
			<h1 class="text-2xl font-semibold text-gray-900 sm:text-3xl dark:text-white">
				Subject: {subjectName}
			</h1>
			<hr class="my-6 border-gray-200 dark:border-gray-800" />
			<p>Explore items related to <strong>{subjectName}</strong>:</p>
			<ul class="list-disc ml-5">
				{subjectItems.map((item) => (
					<li key={item.id}>
						<a
							href={`/item/${item.slug}`}
							class="text-blue-600 hover:underline"
						>
							{item.title}
						</a>
					</li>
				))}
			</ul>
		</div>
	</section>
</BaseLayout>