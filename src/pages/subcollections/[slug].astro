---
import App from '../../components/Search/App'; // Adjust path if necessary
import items from '../../data/items.json';

// A simple slugify function that replaces spaces with dashes and removes non-word characters.
function slugify(str: string): string {
  return str
    .toLowerCase()
    .trim()
    .replace(/\s+/g, "-")       // Replace spaces with dashes
    .replace(/[^\w\-]+/g, "")    // Remove all non-word characters except dashes
    .replace(/\-\-+/g, "-")      // Replace multiple dashes with a single dash
    .replace(/^-+/, "")          // Trim dashes from the start
    .replace(/-+$/, "");         // Trim dashes from the end
}

export async function getStaticPaths() {
  // Collect unique subcollection names from items.json
  const uniqueSubcollections = Array.from(
    new Set(items.map((item) => item.subcollection).filter(Boolean))
  );

  return uniqueSubcollections.map((sub) => ({
    params: { slug: slugify(sub) },
  }));
}

const { slug } = Astro.params;

// Find the original subcollection name that matches the slug.
const subcollection = items
  .map((item) => item.subcollection)
  .filter(Boolean)
  .find((name, index, self) => self.indexOf(name) === index && slugify(name) === slug);

if (!subcollection) {
  throw new Error(`Subcollection "${slug}" not found`);
}
---

<html lang="en">
<head>
  <title>{subcollection} â€“ Kaplan Collection</title>
  <!-- Additional meta tags can go here -->
</head>
<body>
<!-- Pass the correctly named prop "subcollection" to App -->
<App subcollection={subcollection} />
</body>
</html>